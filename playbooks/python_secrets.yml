---
- name: Secure Python Secrets
  hosts: all
  vars_files:
    - files/secrets.yml

  tasks:

    - name: Set my API key
      register: my_output
      changed_when: my_output.rc != 0
      ansible.builtin.shell:
        cmd: "echo $DYNATRACE_API_KEY"
        environment:
          DYNATRACE_API_KEY: "{{ dynatrace_api_key }}"

    - name: Echo my DYNATRACE_API_KEY again
      register: my_output
      changed_when: my_output.rc != 0
      ansible.builtin.shell:
        cmd: "echo $DYNATRACE_API_KEY"
